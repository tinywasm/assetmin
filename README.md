# ğŸ“¦ AssetMin
<!-- START_SECTION:BADGES_SECTION -->
<a href="docs/img/badges.svg"><img src="docs/img/badges.svg" alt="Project Badges" title="Generated by badges package from github.com/cdvelop/devscripts"></a>
<!-- END_SECTION:BADGES_SECTION -->

> ğŸš€ A lightweight and efficient web asset packager and minifier for Go applications

AssetMin bundles and minifies your JavaScript, CSS, SVG, and HTML files with support for both memory-based and disk-based serving. Perfect for development and production workflows.

## ğŸ› ï¸ Primary Use Case

AssetMin is primarily used in the [GoDEV](https://github.com/tinywasm/godev) framework for developing full stack projects with Go. It provides an efficient solution for managing and optimizing web assets, ensuring seamless integration into your Go workflow.

## âœ¨ Features

- ğŸ”„ **Live Asset Processing** - Event-driven file processing with automatic cache invalidation
- ğŸ—œï¸ **Minification** - Optimized minification using [tdewolff/minify](https://github.com/tdewolff/minify)
- ğŸ’¾ **Dual Work Modes** - Memory-only (dev) or disk-based (production) serving
- ğŸŒ **HTTP Serving** - Built-in HTTP handlers with configurable URL prefixes
- ğŸ”’ **Thread-Safe** - Concurrent file processing with mutex protection
- ğŸ“¦ **Asset Bundling** - Combines multiple files into optimized bundles
- âš¡ **Smart Caching** - In-memory cache for instant HTTP responses

## ğŸ“¥ Installation

```bash
go get github.com/tinywasm/assetmin
```

## ğŸš€ Quick Start

```go
package main

import (
	"log"
	"net/http"
	
	"github.com/tinywasm/assetmin"
)

func main() {
	// Create configuration
	config := &assetmin.Config{
		OutputDir: "web/public",
		Logger: func(msg ...any) {
			log.Println(msg...)
		},
		AppName: "MyApp",
		AssetsURLPrefix: "/assets/",
	}
	
	// Initialize AssetMin
	am := assetmin.NewAssetMin(config)
	
	// Register HTTP routes
	mux := http.NewServeMux()
	am.RegisterRoutes(mux)
	
	// Process files
	am.NewFileEvent("button.css", ".css", "./src/button.css", "create")
	am.NewFileEvent("app.js", ".js", "./src/app.js", "create")
	
	// Start server
	log.Println("Server running on :8080")
	http.ListenAndServe(":8080", mux)
}
```

## ğŸ”„ How It Works

1. **Configure** - Set output directory and options
2. **Initialize** - Create AssetMin instance
3. **Process Events** - Notify AssetMin of file changes
4. **Serve** - Assets are minified, cached, and served via HTTP
5. **Deploy** - Switch to DiskMode to write optimized files

## ğŸ“š Documentation

- **[API Documentation](docs/API.md)** - Complete API reference with examples
- **[Roadmap](docs/ROADMAP.md)** - Planned features and improvements
- **[Contributing](docs/CONTRIBUTING.md)** - Contribution guidelines

## ğŸ¯ Core API

### Configuration

```go
type Config struct {
    OutputDir               string                 // Output directory for assets
    Logger                  func(message ...any)   // Logging function
    GetRuntimeInitializerJS func() (string, error) // JS initialization code
    AppName                 string                 // Application name
    AssetsURLPrefix         string                 // URL prefix for assets
}
```

### Main Methods

```go
// Create new instance
am := assetmin.NewAssetMin(config)

// Process file events
am.NewFileEvent(fileName, extension, filePath, event)

// Register HTTP routes
am.RegisterRoutes(mux)

// Work mode control
am.SetWorkMode(assetmin.DiskMode)    // Write to disk
am.SetWorkMode(assetmin.MemoryMode)  // Memory only (default)

// Manual asset refresh
am.RefreshAsset(".js")  // Rebuild JavaScript bundle
```

## ğŸŒ HTTP Routes

AssetMin automatically registers routes for all assets:

| Asset | Default Route | With Prefix `/assets/` |
|-------|---------------|------------------------|
| index.html | `/` | `/` |
| style.css | `/style.css` | `/assets/style.css` |
| script.js | `/script.js` | `/assets/script.js` |
| sprite.svg | `/sprite.svg` | `/assets/sprite.svg` |
| favicon.svg | `/favicon.svg` | `/assets/favicon.svg` |

## ğŸ’¾ Work Modes

### MemoryMode (Default)
- Serves assets from in-memory cache
- No disk writes
- Fastest for development

### DiskMode
- Writes assets to disk on changes
- Still serves from cache for performance
- Useful for production builds

```go
// Development
am.SetWorkMode(assetmin.MemoryMode)

// Production
am.SetWorkMode(assetmin.DiskMode)
am.EnsureOutputDirectoryExists()
```

## ğŸ“‹ Supported File Types

- **JavaScript** (`.js`) - Bundled with automatic `'use strict'` handling
- **CSS** (`.css`) - Merged and minified stylesheets
- **SVG** (`.svg`) - Icon sprites and favicons
- **HTML** (`.html`) - Template fragments (complete documents ignored)

## ğŸ”§ Advanced Usage

See the [API Documentation](docs/API.md) for:
- WASM integration examples
- File watcher integration
- Development vs production setup
- Thread safety details
- Performance considerations

## ğŸ“‹ Roadmap

- âœ… Config Simplification
- âœ… Asset Caching System
- âœ… HTTP Routes & Work Modes
- ğŸ”„ Template System Refactor
- ğŸ”„ TUI Integration
- ğŸ”„ Enhanced SSR Support

See [docs/ROADMAP.md](docs/ROADMAP.md) for details.

---

## ğŸ“„ License

This project is licensed under the [MIT] License.
